---
source: "https://publish.obsidian.md/napkinium/Ideas/Dataview/Learnings/Dataview+Learnings"
---
````chat
left: 😯
right: 🤣
titleMode: all
< 答叔。  
> ……等等我其实一直没搞明白，为啥你叫我答叔？我有那么老么？  
< 诶？  
> 诶？

< 咳咳。那，大叔。  
> (#\`O′)

< 叔啊。  
> ……随你了。  
< 上次我看你讲的，感觉DVJS里面的类型坑很多啊。  
> DVJS里面的类型是不少。坑也到处都是。  
< 那你给说说。我用普通的DV的时候就感觉好多类型都是长得差不多，但是坑却贼多的。  
> 成。我直接对着[官方文档](https://blacksmithgu.github.io/obsidian-dataview/query/expressions/)讲了。  
< 你不是之前好像说要翻译这个文档来着？  
> 嗯？谁说过？我没说过。  
< （盯）  
> （口哨）  
< 哼。

> 那，最简单的类型，比如数字啦，字符串啦，这些应该就不用讲了吧。  
< 不用啦不用啦。数字就是数字，字符串就是文字。  
> 那我们从我们平时在DVJS里面最常用的东西开始。考你，`dv.pages()`，返回的是啥？  
< 是页面的数组！  
> 也对，也不对。  
< 你居然不夸我连数组这种计算机词汇都知道。  
> 你好厉害呀！  
< 不真诚，没感觉，算了。继续说，为什么“也不对”？  
> 因为DVJS为了方便，在很多内置的函数里，返回的是Data Array，“数据数组”这种专有的类型。  
< 可我看你之前用的时候，感觉和数组也没啥区别啊？  
> 因为作者在Data Array里实现了很多数组也有的功能，所以显得好像没什么区别。但是，Data Array和JS原生的数组，有一些微妙的区别。  
< 唔。

> 比如，之前讲的sort的功能，还记得吧？  
< 好像记得？第一个参数是“比较什么”，第二个是“升降序”，第三个是……“怎么比较”？  
> 记性不错。  
< 嗯这会还算你夸奖得比较真诚。  
> 然而JS里面普通的数组的sort方法，只有一个可有可无的参数，是我们之前说过的“怎么比较”。  
< ？？？  
> 也就是说，你平时习惯了的`.sort(p => p.file.ctime)`，如果是在普通的JS里面……  
< 你之前根本就没讲第三个“怎么比较”该怎么写啊，欲言又止地看着我我也没法抢答哦。  
> 我没讲吗？怪我怪我。嗯，现在临时补一下吧。这个“怎么比较”，在JS和DVJS里面都是一样的，是一个要求两个参数`a`和`b`，输出一个数字的函数。两个参数就是要比较的两个对象；输出的数字呢，如果`a`该在`b`前，就是负数，反之则是整数，如果两个排序顺序相同，那么输出0。  
< 求火中举🌰。  
> 比如如果排序的是普通的数字，那么`(a, b) => a - b`就可以了。你看看。  
< 哦，如果两个数分别是4和6，那么4应该排在前面，4 - 6是-2，嗯，没错。然后两个数相等的话差就是0，也可以。可是可但是，如果不是比较数字，而是比较字符串或者颜色呢？  
> 这种情况下，“大小”的概念就完全由你决定。字符串一般是按照字母顺序排，而其他没有明显顺序的，在JS里默认就是先转换成字符串，再排。  
< 哦（似懂非懂）。你刚才说排序文件创建时间来着。  
> 刚才的那个，在普通的JS数组里，就得这么写：`.sort((a, b) => a.file.ctime.toSeconds() - b.file.ctime.toSeconds())`。  
< 这是把时间转换成秒数然后对比啊。好长！不能直接比嘛？  
> 直接比就会转换成字符串之后比。根据你的地区语言设定，最后的结果未必符合你的预期。比如，"September"和"November"这俩，时间和字母顺序相反。  
< 还真是防不胜防啊。  
> 你还说我老，这个梗是几几年的了？

< 行，那你这么说，我知道了，Data Array好用，但并不是Array。  
> 基本记住这个就行。  
< 那我又有问题了。Data Array里面，我们经常有`dv.pages("").file.tags`这类的写法，对吧。  
> 对。  
< 里面`dv.pages("")`是一个Data Array。但是我看，一般数组要访问里面对象的属性的时候，不是得指定序号才行嘛？比如`list[0].file.tag`这样。这里是直接访问整个数列的`file.tag`？  
> 对。  
< ……那如果是访问我自己定义的属性`评分`，就是`dv.pages("").评分`？  
> 对头。  
< 可……评分是_页面_ 的属性啊，并不是Data Array的属性啊？这不是类型对不上吗？  
> 问得好！正常来说，确实是不行的。  
< 然而不正常。  
> 然而不正常。Data Array用了一些JS的~高级技巧~黑魔法，让你用访问单个对象的属性的语法，去获得整个数组里每个对象对应的那个属性。比如，`dv.pages("").file.tags`，_大约_ 等效于`dv.pages("").map(p => p.file).map(f => f.tags)`。  
< 这么厉害的？  
> 而且这个过程里，Data Array会替你做一些清理的工作，比如并不是所有的页面都有某个你要的属性，那么它会帮你忽略；有的页面里的这个属性的内容数目不同（比如`.file.tags`），它会帮你把所有的整合在一起，摊平了给你，这样你的结果就不是一个数组的数组，而是只有单独一层。  
< 我还想问为什么`dv.pages("").file.tags`不是一个二维数组呢，原来是被自动摊平了啊。哦，不过摊平了之后有很多重复。  
> 加一个`.distinct()`就好。

< 还有什么值得小心的类型的问题吗？  
> 有这么几个。页面的自带属性里，像是`file.name`啦，`file.folder`啦，都是没什么特别的字符串。所有跟时间有关的，比如`file.ctime`啦，`file.mday`啦，都是——  
< `luxon.DateTime`，说过几次了。  
> 然后，`file.tags`、`file.etags`还有`file.aliase`是字符串为内容的数组，然而`file.inlinks`，`file.outlinks`，以及`file.link`，都是跟Link这个对象打交道的，并不是普通的字符串，更不是页面对象，在使用的时候要注意。  
< 那要怎么对比？  
> 可以用它的`.path`来看它的实际路径。  
< 那链接的名字呢？  
> ……  
< 那链接的名字呢？  
> …………  
< 不会……真的没有吧？  
> ……会。  
< ……

> ……还有就是你如果在文件的yaml里面输入了一个属性，内容如果符合ISO的时间格式的话，或者是简单的时长格式的话，会被自动转换成时间对象，也就不再是字符串了，切记小心。  
< 我还没有从上一次的打击里恢复过来。