/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var T=Object.create;var S=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var v=l=>S(l,"__esModule",{value:!0});var B=(l,t)=>{v(l);for(var e in t)S(l,e,{get:t[e],enumerable:!0})},I=(l,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of D(t))!A.call(l,s)&&s!=="default"&&S(l,s,{get:()=>t[s],enumerable:!(e=H(t,s))||e.enumerable});return l},R=l=>I(v(S(l!=null?T(P(l)):{},"default",l&&l.__esModule&&"default"in l?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0})),l);var w=(l,t,e)=>new Promise((s,n)=>{var r=h=>{try{i(e.next(h))}catch(d){n(d)}},a=h=>{try{i(e.throw(h))}catch(d){n(d)}},i=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,a);i((e=e.apply(l,t)).next())});B(exports,{default:()=>x});function p(l,t){let e=Object.keys(t).map(s=>q(l,s,t[s]));return e.length===1?e[0]:function(){e.forEach(s=>s())}}function q(l,t,e){let s=l[t],n=l.hasOwnProperty(t),r=e(s);return s&&Object.setPrototypeOf(r,s),Object.setPrototypeOf(a,r),l[t]=a,i;function a(...h){return r===s&&l[t]===a&&i(),r.apply(this,h)}function i(){l[t]===a&&(n?l[t]=s:delete l[t]),r!==s&&(r=s,Object.setPrototypeOf(a,s||Function))}}var c=R(require("obsidian"));var k=R(require("obsidian")),b=class extends k.MarkdownRenderer{constructor(t,e,s){super(t,e);this.app=t,this.match=s,this.subpath="",this.indent="",this.filePath=this.match.parent.path,this.file=this.match.parent.file,this.renderer.previewEl.onNodeInserted(()=>(this.updateOptions(),this.renderer.onResize()))}updateOptions(){let t=this.app.vault.getConfig("readableLineLength");this.renderer.previewEl.toggleClass("is-readable-line-width",t);let e=this.app.vault.getConfig("foldHeading");this.renderer.previewEl.toggleClass("allow-fold-headings",e);let s=this.app.vault.getConfig("foldIndent");this.renderer.previewEl.toggleClass("allow-fold-lists",s),this.renderer.previewEl.toggleClass("rtl",this.app.vault.getConfig("rightToLeft")),e||this.renderer.unfoldAllHeadings(),s||this.renderer.unfoldAllLists(),this.renderer.previewEl.toggleClass("show-frontmatter",this.app.vault.getConfig("showFrontmatter"));let n=this.app.vault.getConfig("tabSize");this.renderer.previewEl.style.tabSize=String(n),this.renderer.rerender()}onRenderComplete(){}getFile(){return this.match.parent.file}edit(t){return w(this,null,function*(){var h;this.renderer.set(t);let e=yield this.app.vault.cachedRead(this.file),n=(h=e.slice(this.match.start,this.match.end).match(/^\s+/g))==null?void 0:h.first();n&&(t=t.replace(/^/gm,n));let r=e.slice(0,this.match.start),a=e.slice(this.match.end,this.match.parent.content.length);var i=r+t+a;this.app.vault.modify(this.file,i)})}};var y=R(require("obsidian"));var f=i18next.t.bind(i18next);var O={defaultCollapse:!1,defaultShowContext:!1,defaultHideTitle:!1,defaultHideResults:!1,defaultRenderMarkdown:!1,defaultSortOrder:"alphabetical"},E={alphabetical:f("plugins.file-explorer.label-sort-a-to-z"),alphabeticalReverse:f("plugins.file-explorer.label-sort-z-to-a"),byModifiedTime:f("plugins.file-explorer.label-sort-new-to-old"),byModifiedTimeReverse:f("plugins.file-explorer.label-sort-old-to-new"),byCreatedTime:f("plugins.file-explorer.label-sort-created-new-to-old"),byCreatedTimeReverse:f("plugins.file-explorer.label-sort-created-old-to-new")},M=class extends y.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}hide(){}display(){let{containerEl:t}=this;t.empty(),new y.Setting(t).setName("Collapse query results by default").addToggle(e=>e.setValue(this.plugin.settings.defaultCollapse).onChange(s=>{this.plugin.settings.defaultCollapse=s,this.plugin.saveSettings()})),new y.Setting(t).setName("Show additional query result context by default").addToggle(e=>e.setValue(this.plugin.settings.defaultShowContext).onChange(s=>{this.plugin.settings.defaultShowContext=s,this.plugin.saveSettings()})),new y.Setting(t).setName("Hide query title by default").addToggle(e=>e.setValue(this.plugin.settings.defaultHideTitle).onChange(s=>{this.plugin.settings.defaultHideTitle=s,this.plugin.saveSettings()})),new y.Setting(t).setName("Hide query results by default").addToggle(e=>e.setValue(this.plugin.settings.defaultHideResults).onChange(s=>{this.plugin.settings.defaultHideResults=s,this.plugin.saveSettings()})),new y.Setting(t).setName("Render results as Markdown by default").addToggle(e=>e.setValue(this.plugin.settings.defaultRenderMarkdown).onChange(s=>{this.plugin.settings.defaultRenderMarkdown=s,this.plugin.saveSettings()})),new y.Setting(t).setName("Default query result sort order").addDropdown(e=>{e.addOptions(E),e.setValue(this.plugin.settings.defaultSortOrder),e.onChange(s=>w(this,null,function*(){this.plugin.settings.defaultSortOrder=s,yield this.plugin.saveSettings()}))})}};var x=class extends c.Plugin{onload(){return w(this,null,function*(){yield this.loadSettings();let t=this;this.registerSettingsTab(),this.register(p(this.app.viewRegistry.constructor.prototype,{registerView(s){return function(n,r,...a){return t.app.workspace.trigger("view-registered",n,r),s.call(this,n,r,...a)}}}));let e;if(this.app.workspace.layoutReady)this.getSearchExport();else{let s=this.app.workspace.on("view-registered",(n,r)=>{if(n!=="search")return;this.app.workspace.offref(s);let a=new c.WorkspaceLeaf(t.app),i=r(a);t.patchNativeSearch(i);let h=p(c.Modal.prototype,{open(d){return function(...g){t.SearchResultsExport=this.constructor}}});i.onCopyResultsClick(new MouseEvent(null)),h(),t.SearchHeaderDOM=i.headerDom.constructor})}this.register(e=p(c.Component.prototype,{addChild(s){return function(n,...r){try{if(n instanceof c.Component&&n.hasOwnProperty("searchQuery")&&n.hasOwnProperty("sourcePath")&&n.hasOwnProperty("dom")){let i=n;t.patchSearchView(i),e()}}catch(i){console.log(i)}return s.call(this,n,...r)}}}))})}loadSettings(){return w(this,null,function*(){this.settings=Object.assign({},O,yield this.loadData())})}saveSettings(){return w(this,null,function*(){yield this.saveData(this.settings)})}registerSettingsTab(){this.settingsTab=new M(this.app,this),this.addSettingTab(this.settingsTab)}getSearchHeader(){var e,s,n;let t=(n=(s=(e=this.app.workspace.getLeavesOfType("search"))==null?void 0:e.first())==null?void 0:s.view)==null?void 0:n.headerDom;return t==null?void 0:t.constructor}getSearchExport(){var n,r;let t=this,e=(r=(n=this.app.workspace.getLeavesOfType("search"))==null?void 0:n.first())==null?void 0:r.view,s=p(c.Modal.prototype,{open(a){return function(...i){t.SearchResultsExport=this.constructor}}});e==null||e.onCopyResultsClick(new MouseEvent(null)),s()}onunload(){}patchNativeSearch(t){let e=this;this.register(p(t.constructor.prototype,{onResize(s){return function(...n){return this.dom.el.clientWidth===0?(this.dom.children.forEach(r=>{r.setCollapse(!0,!1)}),this.dom.hidden=!0):this.dom.hidden&&(this.dom.hidden=!1,setTimeout(()=>{this.dom.children.forEach(r=>{r.setCollapse(this.dom.collapseAll,!1)})},100)),s.call(this,...n)}},stopSearch(s){return function(...n){let r=s.call(this,...n);return this.renderComponent&&(this.renderComponent.unload(),this.renderComponent=new c.Component),r}},addChild(s){return function(...n){try{if(!this.patched){this.renderComponent||(this.renderComponent=new c.Component,this.renderComponent.load()),this.patched=!0,this.dom.parent=this,e.patchSearchResultDOM(this.dom.constructor),this.setRenderMarkdown=function(i){this.dom.renderMarkdown=i,this.dom.children.forEach(h=>{h.renderContentMatches()}),this.dom.infinityScroll.invalidateAll(),this.dom.childrenEl.toggleClass("cm-preview-code-block",i),this.dom.childrenEl.toggleClass("is-rendered",i),this.renderMarkdownButtonEl.toggleClass("is-active",i)},this.renderMarkdownButtonEl=this.headerDom.addNavButton("reading-glasses","Render Markdown",()=>this.setRenderMarkdown(!this.dom.renderMarkdown));let a={renderMarkdown:e.settings.defaultRenderMarkdown};this.settings||(this.settings={}),Object.entries(a).forEach(([i,h])=>{this.settings.hasOwnProperty(i)?i==="sort"&&!E.hasOwnProperty(this.settings.sort)&&(this.settings[i]=h):this.settings[i]=h}),this.setRenderMarkdown(this.settings.renderMarkdown)}}catch(a){console.log(a)}return s.call(this,...n)}}}))}patchSearchResultDOM(t){let e=this,s=p(t.prototype,{addResult(n){return function(...r){s();let a=n.call(this,...r),i=a.constructor;return e.isSearchResultItemPatched||e.patchSearchResultItem(i),a}}});this.register(s),this.register(p(t.prototype,{startLoader(n){return function(...r){var i,h;try{if(!this.patched&&((i=this.el.parentElement)==null?void 0:i.hasClass("internal-query"))&&((h=this.el)==null?void 0:h.closest(".internal-query"))){this.patched=!0;let d=this.el.parentElement.querySelector(".internal-query-header");this.setExtraContext=function(o){this.extraContext=o,this.extraContextButtonEl.toggleClass("is-active",o),this.children.forEach(m=>{m.setExtraContext(o)}),this.infinityScroll.invalidateAll()},this.setTitleDisplay=function(o){this.showTitle=o,this.showTitleButtonEl.toggleClass("is-active",o),d.toggleClass("is-hidden",o)},this.setResultsDisplay=function(o){this.showResults=o,this.showResultsButtonEl.toggleClass("is-active",o),this.el.toggleClass("is-hidden",o)},this.setRenderMarkdown=function(o){this.renderMarkdown=o,this.children.forEach(m=>{m.renderContentMatches()}),this.infinityScroll.invalidateAll(),this.childrenEl.toggleClass("cm-preview-code-block",o),this.childrenEl.toggleClass("is-rendered",o),this.renderMarkdownButtonEl.toggleClass("is-active",o)},this.setCollapseAll=function(o){this.collapseAllButtonEl.toggleClass("is-active",o),this.collapseAll=o,this.children.forEach(m=>{m.setCollapse(o,!1)}),this.infinityScroll.invalidateAll()},this.setSortOrder=o=>{this.sortOrder=o,this.changed(),this.infinityScroll.invalidateAll()},this.onCopyResultsClick=o=>{o.preventDefault(),new e.SearchResultsExport(this.app,this).open()};let g=e.SearchHeaderDOM?e.SearchHeaderDOM:e.getSearchHeader(),u=this.headerDom=new g(this.app,this.el.parentElement);d.insertAdjacentElement("afterend",u.navHeaderEl),this.collapseAllButtonEl=u.addNavButton("bullet-list",f("plugins.search.label-collapse-results"),()=>this.setCollapseAll(!this.collapseAll)),this.extraContextButtonEl=u.addNavButton("expand-vertically",f("plugins.search.label-more-context"),()=>this.setExtraContext(!this.extraContext)),u.addSortButton(o=>this.setSortOrder(o),()=>this.sortOrder),this.showTitleButtonEl=u.addNavButton("strikethrough-glyph","Hide title",()=>this.setTitleDisplay(!this.showTitle)),this.showResultsButtonEl=u.addNavButton("minus-with-circle","Hide results",()=>this.setResultsDisplay(!this.showResults)),this.renderMarkdownButtonEl=u.addNavButton("reading-glasses","Render Markdown",()=>this.setRenderMarkdown(!this.renderMarkdown)),u.addNavButton("documents","Copy results",this.onCopyResultsClick.bind(this));let C={title:e.settings.defaultHideResults,collapsed:e.settings.defaultCollapse,context:e.settings.defaultShowContext,hideTitle:e.settings.defaultHideTitle,hideResults:e.settings.defaultHideResults,renderMarkdown:e.settings.defaultRenderMarkdown,sort:e.settings.defaultSortOrder};this.settings||(this.settings={}),Object.entries(C).forEach(([o,m])=>{this.settings.hasOwnProperty(o)?o==="sort"&&!E.hasOwnProperty(this.settings.sort)&&(this.settings[o]=m):this.settings[o]=m}),this.setExtraContext(this.settings.context),this.sortOrder=this.settings.sort,this.setCollapseAll(this.settings.collapsed),this.setTitleDisplay(this.settings.hideTitle),this.setRenderMarkdown(this.settings.renderMarkdown),this.setResultsDisplay(this.settings.hideResults)}}catch(d){console.log(d)}return n.call(this,...r)}}}))}patchSearchResultItem(t){this.isSearchResultItemPatched=!0;let e=this,s=p(t.prototype,{onResultClick(n){return function(r,a,...i){if(!(r.target instanceof HTMLElement&&(r.target.hasClass("internal-link")||r.target.hasClass("task-list-item-checkbox")||r.target.hasClass("admonition-title-content"))))return n.call(this,r,a,...i)}},renderContentMatches(n){return function(...r){var i;let a=n.call(this,...r);if(!e.isSearchResultItemMatchPatched){let h=(i=this.children.first())==null?void 0:i.constructor;e.patchSearchResultItemMatch(h)}return a}}});e.register(s)}patchSearchResultItemMatch(t){this.isSearchResultItemMatchPatched=!0;let e=this;e.register(p(t.prototype,{render(s){return function(...n){var h;let r=this.parent.content.substring(this.start,this.end).replace("```query","\\`\\`\\`query"),a=(h=r.match(/^\s+/g))==null?void 0:h.first();a&&(r=r.replace(new RegExp(`^${a}`,"gm"),""));let i=this.parent.parent.parent;if(i&&this.parent.parent.renderMarkdown){let d=i==null?void 0:i.renderComponent;this.el.empty();let g=new b(e.app,this.el,this);g.onRenderComplete=()=>{this.parent.parent.infinityScroll.measure(this.parent,this)},d.addChild(g),g.renderer.set(r)}else return s.call(this,...n)}}}))}patchSearchView(t){let e=this,s=t.constructor,n=t.dom.constructor;this.register(p(s.prototype,{onunload(r){return function(...a){return this.renderComponent&&(this.renderComponent.unload(),this.dom=null,this.queue=null,this.renderComponent=null,this._children=null,this.containerEl=null),r.call(this,...a)}},onload(r){return function(...a){try{this.renderComponent||(this.renderComponent=new c.Component,this.renderComponent.load()),this.dom.parent=this;let h=this.containerEl.parentElement.querySelector(".internal-query-header"),d=this.query.matchAll(/^(?<key>collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):\s*(?<value>.+?)$/gm),g={};for(let u of d){let C=u.groups.value.toLowerCase();(C==="true"||C==="false")&&(u.groups.value=C==="true"),g[u.groups.key]=u.groups.value}this.query=this.query.replace(/^((collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):.+?)$/gm,"").trim(),h.setText(g.title||this.query),this.dom.settings=g}catch(h){}return r.call(this,...a)}}})),this.patchSearchResultDOM(n)}};
