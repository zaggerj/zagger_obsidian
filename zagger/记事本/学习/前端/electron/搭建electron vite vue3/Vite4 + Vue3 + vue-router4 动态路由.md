[åŠ¨æ€è·¯ç”±](https://so.csdn.net/so/search?q=%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1&spm=1001.2101.3001.7020)ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€ä¸ªé¡¹ç›®éƒ½èƒ½æ¥è§¦åˆ°è¿™ä¸ªä¸œè¥¿ï¼Œé€šä¿—ä¸€ç‚¹å°±æ˜¯æˆ‘ä»¬çš„èœå•æ˜¯æ ¹æ®åç«¯æ¥å£è¿”å›çš„æ•°æ®è¿›è¡ŒåŠ¨æ€ç”Ÿæˆçš„ã€‚è¡¨é¢ä¸Šæ˜¯å¯¹èœå•çš„ä¸€ä¸ªå±•ç°å¤„ç†ï¼Œå…¶å®å†…éƒ¨å°±æ˜¯å¯¹routerçš„ä¸€ä¸ªæ•°æ®å¤„ç†ã€‚å½“ç„¶ä½ åªå¯¹èœå•åšå¤„ç†ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œç†Ÿæ‚‰routerçš„å°ä¼™ä¼´éƒ½çŸ¥é“ï¼Œå¦‚æœä½ çš„ä¸€ä¸ªè·¯ç”±å­˜åœ¨ï¼Œå³ä½¿æ²¡æœ‰è¿™ä¸ªèœå•ï¼Œæˆ‘åªè¦æ”¹å˜æµè§ˆå™¨çš„åœ°å€ä¸€æ ·èƒ½è®¿é—®åˆ°ã€‚æ‰€ä»¥ä½ è¿˜æ˜¯çœä¸äº†ä¿®æ”¹routerçš„æ­¥éª¤ã€‚é€šè¿‡æ¥å£è·å–æ•°æ®çš„è¯å°±å¯ä»¥æ ¹æ®è§’è‰²æƒé™æˆ–è€…ä¸€äº›ä¸šåŠ¡ä¸Šçš„éœ€æ±‚ï¼Œæ ¹æ®ä¸åŒå±æ€§å®ç°è·¯ç”±çš„åˆ’åˆ†ã€‚è¾¾åˆ°ä¸åŒçš„é¡µé¢æ¸²æŸ“æ•ˆæœã€‚ æœ¬æ–‡åªæ˜¯è®²è§£èœå•çš„[æƒé™æ§åˆ¶](https://so.csdn.net/so/search?q=%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6&spm=1001.2101.3001.7020)ï¼Œä¸åˆ°æŒ‰é’®çº§åˆ«ã€‚å…¶å®æŒ‰é’®ä¹Ÿæ˜¯å·®ä¸å¤šçš„ã€‚å¯ä»¥è®¾ç½®ä¸€ä¸ªå±æ€§è¡¨ç¤ºèœå•ï¼Œä¸€ä¸ªå±æ€§è¡¨ç¤ºæŒ‰é’®ï¼Œæ¯ä¸€ä¸ªèœå•çš„å¶å­èŠ‚ç‚¹ä¸Šéƒ½åŒ…å«æ ¹æ®æƒé™è¿”å›çš„æŒ‰é’®æ•°ç»„ã€‚æ¥ç€å¯ä»¥é€šè¿‡ç»„ä»¶çš„å½¢å¼å»è¾“å‡ºç›¸åº”çš„æŒ‰é’®å°±å¯ä»¥ã€‚ ## ä¸€ã€æ­å»ºé¡¹ç›®Â ğŸ˜›ğŸ˜›ğŸ˜› è¿™é‡Œæˆ‘å·²ç»æå‰æ­å»ºå¥½äº†Â [Vite4+Pinia2+vue-router4+ElmentPlusæ­å»ºVue3é¡¹ç›®(ç»„ä»¶ã€å›¾æ ‡ç­‰æŒ‰éœ€å¼•å…¥)](https://blog.csdn.net/qq_19991931/article/details/128658576?spm=1001.2014.3001.5502 "Vite4+Pinia2+vue-router4+ElmentPlusæ­å»ºVue3é¡¹ç›®(ç»„ä»¶ã€å›¾æ ‡ç­‰æŒ‰éœ€å¼•å…¥)") ## äºŒã€æ ¹æ®ä¸Šé¢é“¾æ¥æ­å»ºå¥½é¡¹ç›®ï¼Œä¿®æ”¹src/router/index.tsÂ ğŸ˜ ğŸ˜‰ asyncRoutesé‡Œé¢å¯ä»¥å­˜æ”¾é»˜è®¤çš„ä¸€äº›è·¯ç”±ï¼Œæ¯”å¦‚ç™»å½•ã€404ã€403è¿™äº›ã€‚ç”±äºæˆ‘åªæ˜¯æ¼”ç¤ºï¼Œæ‰€ä»¥å°±å•¥éƒ½ä¸æ”¾äº†ã€‚æ¸…æ™°æ˜æœ—ä¸€ç‚¹ã€‚ ```TypeScript import { createRouter, createWebHashHistory, RouteRecordRaw } from 'vue-router' export const asyncRoutes: RouteRecordRaw[] = [] const router = createRouter({ history: createWebHashHistory(), routes: asyncRoutes, scrollBehavior: () => ({ left: 0, top: 0 })}) export default router ``` ## ä¸‰ã€åˆ›å»º 'src/layout/index.vue' æ–‡ä»¶Â ğŸ˜ ğŸ˜‰ è¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ•´ä¸ªé¡¹ç›®çš„å¸ƒå±€ï¼Œä¸€èˆ¬æˆ‘ä»¬å¸¸è§çš„é¡¹ç›®éƒ½åˆ†ä¸ºä¸Šä¸‹ç»“æ„ï¼Œå°±å¦‚ä¸‹å›¾ã€‚å¯¼èˆªå’Œèœå•éƒ¨åˆ†åŸºæœ¬ä¸Šæ˜¯ç”¨æˆ·ç™»å½•ä»¥åå°±å·²ç»ç¡®å®šå¥½äº†ï¼Œç‚¹å‡»èœå•çš„æ—¶å€™å»åˆ‡æ¢è·¯ç”±ã€‚æˆ‘è¿™é‡Œç”±äºè¿™éƒ¨åˆ†ä¸æ˜¯é‡ç‚¹ï¼Œæ‰€ä»¥æˆ‘å°±å¾ˆæ½¦è‰çš„ç”»äº†ä¸€ä¸ªå¾ˆç®€å•çš„é¡µé¢ã€‚ ![](https://img-blog.csdnimg.cn/d8f0b6fbd72f423985990df26a1a59b5.png) ```html ``` ## å››ã€åˆ›å»º 'src/pinia/modules/permission.ts' æ–‡ä»¶Â ğŸ˜ ğŸ˜‰ ç”±äºæˆ‘è¿™é‡Œæ˜¯ä¸€ä¸ªdemoï¼Œæ²¡æœ‰çœŸæ­£çš„å»æ¥å…¥åç«¯ã€‚æ‰€ä»¥æˆ‘æš‚æ—¶æ”¾å…¥çš„é™æ€æ•°æ®ã€‚è‡ªå·±æ›¿æ¢æˆæ¥å£è¿”å›å°±å¥½ã€‚ ```TypeScript import { defineStore } from 'pinia';import router from '@/router'// è¿™æ˜¯æ•´ä¸ªé¡¹ç›®çš„å¸ƒå±€é¡µé¢ã€‚æ ¹æ®è‡ªå·±çš„é¡¹ç›®æ›¿æ¢å°±å¥½import Layout from "@/layout/index.vue";import {RouteRecordRaw} from "vue-router"; export type MenuType = { path: string, title: string, component: string, redirect?: string, children?: Array} type RouterType = RouteRecordRaw & { hidden?: boolean; alwaysShow?: boolean;} export interface IPermissionState { routes: RouterType[] dynamicRoutes: RouterType[] menus: Array} function hasPermission(roles: T[], route: RouterType) { if (route.meta && route.meta.roles) { return roles.some((role) => (route.meta?.roles as T[]).includes(role)); } return true} const modules = import.meta.glob('../../views/**/*.vue')const _import = (path: string) => () => import(`../../views/${path}.vue`) const assembleRouter = (routers: any) => { const addRouter = routers.filter((router: any) => { (router.title && router.icon) && (router.meta = { title: router.title, // icon: router.icon, // alwaysShow: router.alwaysShow || false, // affix: router.affix || false, }) if (router.component === 'Layout') { router.component = shallowRef(Layout) } else { if (import.meta.env.MODE === 'development') { router.component = _import(router.component) } else { router.component = modules[`../../views/${router.component}.vue`] } } if (router.children && router.children.length) { router.children = assembleRouter(router.children) } return true }) return addRouter} export function filterAsyncRoutes(routes: RouterType[], roles: string[]) { const res: RouterType[] = [] routes.forEach((route) => { const tmp = { ...route } if (hasPermission(roles, tmp)) { if (tmp.children) { tmp.children = filterAsyncRoutes(tmp.children, roles) } res.push(tmp) } }) return res} export const permissionModule = defineStore({ id: 'permission', state(): IPermissionState{ return { routes: [], dynamicRoutes: [], menus: [] } }, actions:{ async getMenus() { try { // è¿™é‡Œç”±äºä¸æ–¹ä¾¿æ¼”ç¤ºï¼Œæ‰€ä»¥æˆ‘å†™çš„é™æ€æ•°æ®ã€‚æ¢ç€è‡ªå·±å¯¹äºçš„æ¥å£å°±å¥½ const list:MenuType[] = [ { path: '/', title: 'ts-super-web', component: 'Layout', redirect: '/home', children: [ { title: 'home', path: 'home', component: 'home' }, { title: 'home1', path: 'home1', component: 'home1' } ] } ] this.menus = list // ç»„ä»¶è·¯ç”± let addRouter = assembleRouter(this.menus) // addRouter = assembleRouterDelete(addRouter) // åŠ¨æ€æ·»åŠ èœå• addRouter.forEach((ts: any) => { router.addRoute(ts) }) } catch (err) { return Promise.reject(err); } } }}) ``` ## äº”ã€è·¯ç”±æ‹¦æˆªå™¨Â ğŸ˜ ğŸ˜‰ ğŸ˜œ å› ä¸ºä¸Šé¢è¯´åˆ°æˆ‘æ²¡æœ‰çœŸæ­£çš„æ¥å…¥åç«¯ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä¹Ÿæ²¡æœ‰è¿›è¡Œtokenåˆ¤æ–­ã€‚è‡ªè¡Œå¢åŠ ä¸€ä¸‹å°±å¥½ï¼Œæ¯”è¾ƒç®€å•ã€‚é™¤äº†tokenè¿˜å¯ä»¥åœ¨æ‹¦æˆªå™¨é‡Œé¢æ”¾ç½®ä¸€ä¸ªç™½åå•åˆ—è¡¨ï¼Œå¯¹äºç™½åå•é‡Œé¢çš„è·¯ç”±æˆ‘ä»¬ä¸åšæ‹¦æˆªã€‚æ¯”å¦‚loginç™»å½•é¡µé¢ã€404ç­‰ç­‰ã€‚æ ¹æ®è‡ªå·±éœ€æ±‚é…ç½®å°±å¥½ã€‚ ```TypeScript import router from '@/router'// @ts-ignoreimport NProgress from 'nprogress'import 'nprogress/nprogress.css'import appStore from "@/pinia"; NProgress.configure({ easing: 'ease', // åŠ¨ç”»æ–¹å¼ showSpinner: true, // æ˜¯å¦æ˜¾ç¤ºåŠ è½½ico trickleSpeed: 200, // è‡ªåŠ¨é€’å¢é—´éš” minimum: 0.4, // æ›´æ”¹å¯åŠ¨æ—¶ä½¿ç”¨çš„æœ€å°ç™¾åˆ†æ¯”}) router.beforeEach(async (to, form, next) => { // è¿™é‡Œå¤„ç†è‡ªå·±çš„é€»è¾‘,æ¯”å¦‚éœ€è¦ç™»å½•ä»¥åæ‰èƒ½è®¿é—®å…¶ä»–é¡µé¢ç­‰ç­‰ NProgress.start() const { menus, getMenus } = appStore.permissionModule if (menus.length === 0) { try { // è°ƒç”¨æ¥å£è·å–èœå• è¿›è¡Œè·³è½¬ await getMenus() next({ ...to, replace: true }) } catch (err) { next() } } else { next() } NProgress.done()}) ``` ## å…­ã€ä¿®æ”¹app.vue ```html ``` ## ä¸ƒã€src/viewsä¸‹çš„ä¸¤ä¸ªhomeæ–‡ä»¶è¿›è¡Œä¸€ä¸‹ä¿®æ”¹ home è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸ä¿®æ”¹ä¹Ÿä¸å½±å“ã€‚ ```html ``` home1Â è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸ä¿®æ”¹ä¹Ÿä¸å½±å“ã€‚ ```html ``` ## å…«ã€æ•ˆæœæµè§ˆ ![](https://img-blog.csdnimg.cn/37af9e0ef5b641639d0b2f88e2e7c82f.gif) **æˆ‘æ˜¯Etc.Endã€‚å¦‚æœæ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œèƒ½å¦å¸®æˆ‘ç‚¹ä¸ªå…è´¹çš„èµå’Œæ”¶è—ğŸ˜ã€‚** ![](https://img-blog.csdnimg.cn/fe67b61493a24360a7ba98c7f4c52e4e.jpeg) ## ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡ ğŸ‘‡